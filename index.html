<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Letter That Reveals Itself</title>
  <style>
    :root{
      --bg:#0f1724; --accent:#ff6b6b; --muted:rgba(255,255,255,0.65);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:#fff;display:flex;align-items:center;justify-content:center;padding:24px;}
    .wrap{width:min(820px,94%);padding:28px;border-radius:16px;background:rgba(255,255,255,0.03);box-shadow:0 10px 30px rgba(2,6,23,0.6);}
    .paper{min-height:320px;padding:48px 40px;border-radius:10px;background:rgba(255,255,255,0.02);cursor:crosshair;overflow:auto;max-height:70vh;}
    .line{opacity:0;transform:translateY(10px);transition:opacity 600ms,transform 600ms;font-size:20px;line-height:1.45;margin:10px 0;}
    .line.visible{opacity:1;transform:translateY(0);}
    .controls{display:flex;align-items:center;gap:12px;margin-top:18px;}
    .btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:10px;cursor:pointer;color:var(--muted);font-weight:600;}
    .btn.primary{background:linear-gradient(90deg,rgba(255,107,107,0.15),rgba(255,165,85,0.06));color:white;border:1px solid rgba(255,107,107,0.18);}
    .final-message{margin-top:18px;font-size:18px;color:#ffdfe0;display:none;}
    .final-message.visible{display:flex;}
  </style>
</head>
<body>
  <div class="wrap">
    <div id="paper" class="paper" tabindex="0"></div>
    <div class="controls">
      <button id="replay" class="btn">Restart</button>
      <button id="smileBtn" class="btn primary" style="display:none">Press this if you smiled</button>
      <div id="final" class="final-message"><span id="finalText"></span></div>
    </div>
  </div>
  <canvas id="confettiCanvas" style="position:fixed;left:0;top:0;pointer-events:none;width:100%;height:100%;z-index:9999;display:none"></canvas>

  <script>
    // -------------------------------
    // üíñ Local love letter generator
    // -------------------------------
    const GREETINGS = ["Hey love,", "My dearest,", "Hi beautiful,", "Hey you,", "To my favorite person,"];
    const OPENS = [
      "My Love,", 
      "I don‚Äôt know how you do it, but somehow you make even the most ordinary moments feel special.", 
      "A random text from you can flip my whole mood, and just hearing your name makes me smile.", 
      "You‚Äôve become my calm in chaos, my peace in noise, and my favorite part of every single day.", 
      "I‚Äôm not great with words, but I just want you to know that you mean more to me than you can ever imagine.", 
      "You‚Äôre not just someone I love ‚Äî you‚Äôre someone I feel lucky to have found in this lifetime."
    ];
    const MIDS = [
      "Sometimes I just sit and think about how you came into my life out of nowhere ‚Äî and somehow became my everything.",
      "You didn‚Äôt just take a place in my heart; you built a home there.",
      "I love how you laugh, how you care, how you make fun of me and then melt into a smile that makes me forget everything else.",
      "If I could, I‚Äôd pause time just to stay in moments with you a little longer."
    ];
    const METAPHORS = [
      "Loving you feels like breathing ‚Äî it just happens, effortlessly. There‚Äôs a kind of peace I never knew existed until I met you.",
      "You‚Äôve taught me what it means to truly care, to trust, and to be patient with love.",
      "I still remember the first time our eyes met ‚Äî that quiet spark that somehow said, ‚Äúthis is the one.‚Äù",
      "I don‚Äôt know what the future holds, but I know this ‚Äî I want to walk through all of it with you."
    ];
    const CLOSES = [
      "You‚Äôre seriously my favorite human. I mean, who else can make me smile even when I‚Äôm mad?",
      "I love your little habits the dramatic ‚ÄúI miss you‚Äù messages.",
      "You‚Äôve made my life feel lighter, funnier.",
      "You make tomorrow something I actually look forward to."
    ];
    const FINAL = "Press the button if this made you smile ‚Äî I promise a little celebration on my end. ‚ù§Ô∏è";

    function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function generateOneLetter(){
      const letter = [];
      letter.push(rand(GREETINGS));
      letter.push(rand(OPENS));
      letter.push(rand(MIDS));
      if (Math.random() < 0.35) letter.push(rand(MIDS));
      letter.push(rand(METAPHORS));
      letter.push(rand(CLOSES));
      letter.push(FINAL);
      return letter;
    }

    function generateFiveLetters(){
      const letters = [];
      for(let i=0;i<5;i++) letters.push(generateOneLetter());
      return letters;
    }

    // -------------------------------
    // üå∏ Display + Reveal logic
    // -------------------------------
    const paper = document.getElementById('paper');
    const smileBtn = document.getElementById('smileBtn');
    const finalText = document.getElementById('finalText');
    const final = document.getElementById('final');
    const replay = document.getElementById('replay');

    let allLetters = [];
    let shownIndex = 0;

    async function init(){
      allLetters = generateFiveLetters();
      shownIndex = Math.floor(Math.random()*allLetters.length);
      showLetter(allLetters[shownIndex]);
    }

    function showLetter(lines){
      paper.innerHTML = '';
      smileBtn.style.display = 'none';
      final.classList.remove('visible');
      finalText.textContent = '';

      lines.forEach((t,i)=>{
        const p = document.createElement('div');
        p.className='line';
        p.textContent=t;
        paper.appendChild(p);
      });
      setupReveal();
    }

    function setupReveal(){
      const lines = Array.from(document.querySelectorAll('.line'));
      let revealIndex = 0;
      let revealTimer = null;
      let fast = false;

      function revealNext(){
        if(revealIndex >= lines.length) return;
        lines[revealIndex].classList.add('visible');
        revealIndex++;
        if(revealIndex >= lines.length) smileBtn.style.display = 'inline-block';
      }

      function startAutoReveal(){
        if(revealTimer) return;
        revealTimer = setInterval(()=>{
          revealNext();
          if(revealIndex >= lines.length) clearInterval(revealTimer);
        }, fast ? 150 : 600);
      }

      function stopAutoReveal(){
        if(revealTimer){ clearInterval(revealTimer); revealTimer = null; }
      }

      paper.addEventListener('click', ()=>{
        fast = true;
        for(let i=0;i<3;i++) revealNext();
        stopAutoReveal();
        startAutoReveal();
      });

      paper.addEventListener('pointerenter', ()=> startAutoReveal());
      paper.addEventListener('pointerleave', ()=> { stopAutoReveal(); fast=false; });

      smileBtn.onclick = ()=>{
        smileBtn.disabled = true;
        smileBtn.textContent = 'Sending smiles...';
        runConfetti();
        setTimeout(()=>{
          finalText.textContent = "Then my mission's complete ‚ù§Ô∏è";
          final.classList.add('visible');
          smileBtn.style.display = 'none';
        },1200);
      };

      replay.onclick = ()=>{
        const newIndex = Math.floor(Math.random()*allLetters.length);
        showLetter(allLetters[newIndex]);
      };
    }

    function runConfetti(){
      const canvas = document.getElementById('confettiCanvas');
      const ctx = canvas.getContext('2d');
      canvas.style.display='block';
      canvas.width=window.innerWidth;
      canvas.height=window.innerHeight;
      const particles=[], colors=[[255,107,107],[255,205,86],[86,188,255],[178,102,255],[255,132,180]];
      function rand(min,max){ return Math.random()*(max-min)+min; }
      for(let i=0;i<140;i++){
        particles.push({x:rand(0,canvas.width),y:rand(-canvas.height,0),vx:rand(-2,2),vy:rand(2,7),size:Math.floor(rand(6,12)),color:colors[Math.floor(rand(0,colors.length))],rot:rand(0,Math.PI*2),vr:rand(-0.12,0.12),ttl:rand(2200,4200),born:Date.now()});
      }
      let raf;
      function frame(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        const now=Date.now();
        particles.forEach(p=>{
          const age=now-p.born;
          if(age>p.ttl)return;
          p.x+=p.vx;p.y+=p.vy;p.vy+=0.06;p.rot+=p.vr;
          ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rot);
          ctx.fillStyle=`rgba(${p.color[0]},${p.color[1]},${p.color[2]},1)`;
          ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6);
          ctx.restore();
        });
        raf=requestAnimationFrame(frame);
      }
      frame();
      setTimeout(()=>{cancelAnimationFrame(raf);ctx.clearRect(0,0,canvas.width,canvas.height);canvas.style.display='none';},4200);
    }

    window.addEventListener('resize',()=>{
      const canvas=document.getElementById('confettiCanvas');
      canvas.width=window.innerWidth;canvas.height=window.innerHeight;
    });

    init();
  </script>
</body>
</html>

